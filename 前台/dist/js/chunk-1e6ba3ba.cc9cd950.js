(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e6ba3ba"],{"83d3f":function(t,e,s){"use strict";s("f01e")},f01e:function(t,e,s){},f91f:function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Card",{staticClass:"marginB-20",attrs:{title:"工作总结标题/时间"}},[s("template",{slot:"extra"},[s("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1),s("Input",{staticClass:"summary-input marginB-20",attrs:{placeholder:"样例：xxxx年xx月月终工作总结（员工姓名）"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),s("DatePicker",{attrs:{format:"yyyy年MM月",type:"month",placeholder:"工作总结时间"},on:{"on-change":t.onChange},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],2),s("Card",{staticClass:"marginB-20",attrs:{title:"工作总结"}},[t._l(t.submitList,(function(e,a){return s("div",{staticClass:"summary-template"},[s("Tag",{staticClass:"summary-tag",attrs:{color:"primary",size:"large"}},[t._v(t._s(a+1))]),s("Tag",{staticClass:"summary-tag-right",attrs:{color:"warning",size:"large"},nativeOn:{click:function(e){return t.del(a)}}},[s("Icon",{attrs:{type:"md-close"}})],1),s("Row",{staticClass:"marginB-20",attrs:{gutter:20}},[s("Col",{attrs:{span:"24"}},[s("Select",{attrs:{placeholder:"选择系统",filterable:""},model:{value:e.systemId,callback:function(s){t.$set(e,"systemId",s)},expression:"summary.systemId"}},[t._l(t.sysList,(function(e){return[s("Option",{directives:[{name:"show",rawName:"v-show",value:t.systems.includes(e.id),expression:"systems.includes(item.id)"}],attrs:{value:e.id}},[t._v(t._s(e.title))]),t._v(")\n                        ")]}))],2)],1)],1),s("Row",{attrs:{gutter:16}},t._l(e.content,(function(i,n){return s("Col",{staticClass:"marginB-20",attrs:{span:"24"}},[s("Card",[s("div",{staticClass:"marginB-20"},[s("Select",{staticStyle:{width:"400px"},attrs:{filterable:"",placeholder:"填写模块名称"},model:{value:i.contentTitle,callback:function(e){t.$set(i,"contentTitle",e)},expression:"modalItem.contentTitle"}},t._l(t.sysFilter(e.systemId),(function(e,a){return s("Option",{key:a,attrs:{value:e.modelId}},[t._v(t._s(e.modelName))])})),1),t._v("\n                            下拉选项中没有的模块，请在系统模块管理中添加。\n                        ")],1),s("Input",{staticClass:"marginB-20",attrs:{type:"textarea",rows:4,placeholder:"填写工作内容"},model:{value:i.contentDescription,callback:function(e){t.$set(i,"contentDescription",e)},expression:"modalItem.contentDescription"}}),s("Button",{attrs:{type:"error"},on:{click:function(e){return t.delList(a,n)}}},[t._v("删除当前记录")])],1)],1)})),1),s("Row",[s("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){return t.addModal(a)}}},[t._v("添加记录")])],1)],1)})),s("div",{staticClass:"summary-template-add marginB-20",on:{click:t.addSummary}},[s("Icon",{attrs:{type:"md-add",size:"120",color:"#999"}})],1)],2),s("Card",{staticClass:"marginB-20",attrs:{title:"工作计划"}},[t._l(t.gzjh,(function(e,a){return s("div",{staticClass:"summary-template"},[s("Tag",{staticClass:"summary-tag",attrs:{color:"primary",size:"large"}},[t._v(t._s(a+1))]),s("Tag",{staticClass:"summary-tag-right",attrs:{color:"warning",size:"large"},nativeOn:{click:function(e){return t.delGzjh(a)}}},[s("Icon",{attrs:{type:"md-close"}})],1),s("Row",{attrs:{gutter:20}},[s("Col",{staticClass:"marginB-20",attrs:{span:"24"}},[s("Select",{attrs:{placeholder:"选择系统",filterable:""},model:{value:e.systemId,callback:function(s){t.$set(e,"systemId",s)},expression:"summary.systemId"}},[t._l(t.sysList,(function(e){return[s("Option",{directives:[{name:"show",rawName:"v-show",value:t.systems.includes(e.id),expression:"systems.includes(item.id)"}],attrs:{value:e.id}},[t._v(t._s(e.title))])]}))],2)],1),s("Col",{attrs:{span:"24"}},[s("Input",{staticClass:"marginB-20",attrs:{type:"textarea",rows:6,placeholder:"填写工作内容"},model:{value:e.gzjh,callback:function(s){t.$set(e,"gzjh",s)},expression:"summary.gzjh"}})],1)],1)],1)})),s("div",{staticClass:"summary-template-add marginB-20",on:{click:t.addGzjh}},[s("Icon",{attrs:{type:"md-add",size:"120",color:"#999"}})],1)],2),s("Row",[s("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:t.submit}},[t._v("保存")])],1),s("Modal",{attrs:{title:t.modalTitle},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[s("Input",{attrs:{placeholder:"输入模块名称"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),s("template",{slot:"footer"},[s("Button",{on:{click:function(e){t.modal=!1}}},[t._v("取消")]),s("Button",{attrs:{type:"primary"},on:{click:t.addModalName}},[t._v("添加模块")])],1)],2)],1)},i=[],n=s("365c"),o=s("caaf"),r=s.n(o),l={data:function(){return{title:"",gzjh:[],modalTitle:"",value:"",id:"",modal:!1,documentId:"",sysList:[],time:new Date,modalList:[],systems:JSON.parse(localStorage.getItem("userInfo")).systems,submitList:[]}},methods:{sysFilter:function(t){return _.filter(this.modelList,["systemId",t])},add:function(t){this.submitList[t].systemId?(this.id=this.submitList[t].systemId,this.modalTitle=_.find(this.sysList,["id",this.id]).title,this.modal=!0):this.$Message.error("请先选择系统")},addModalName:function(){var t=this;if(""!=this.value){var e=_.find(this.sysList,["id",this.id]).modal;e.push(this.value);var s={systemId:this.id,modalList:Array.from(new Set(e))};Object(n["c"])(s).then((function(e){1===e.code&&(t.$Message.success("添加成功"),t.modal=!1,t.init(),t.value)}))}else this.$Message.error("请填写模块名称")},onChange:function(t){this.title="设计部".concat(t,"工作小结（").concat(JSON.parse(localStorage.getItem("userInfo")).nickName,"）")},setPostData:function(){var t=this,e=[],s=JSON.parse(localStorage.getItem("userInfo"));return this.submitList.forEach((function(a,i){a.content.forEach((function(i){e.push({documentId:t.documentId,documentName:t.title,userId:s.userId,userName:s.userName,nickName:s.nickName,year:r()(t.time).format("YYYY"),month:r()(t.time).format("MM"),systemId:a.systemId,time:a.time,systemName:_.find(t.sysList,["id",a.systemId]).title,contentTitle:i.contentTitle,contentDescription:i.contentDescription})}))})),e},setGzjh:function(){var t=this,e=[];return this.gzjh.forEach((function(s,a){e.push({systemId:s.systemId,systemName:_.find(t.sysList,["id",s.systemId]).title,gzjh:s.gzjh})})),e},submit:function(){var t=this;if(0!=this.gzjh.length){var e={summaryName:this.title,list:JSON.stringify(this.setPostData()),gzjh:this.setGzjh()};""!=this.documentId?Object(n["z"])(this.$route.query.type,e).then((function(e){1==e.code?t.$router.go(-1):t.$Message.error(e.msg)})):Object(n["b"])(this.$route.query.type,e).then((function(e){1==e.code?t.$router.go(-1):t.$Message.error(e.msg)}))}else this.$Message.error("请填写工作计划")},init:function(){var t=this;Object(n["Y"])().then((function(e){t.modelList=e.data,Object(n["L"])().then((function(e){t.sysList=e.data}))}))},addModal:function(t){this.submitList[t].content.push({contentTitle:"",contentDescription:""})},addSummary:function(){this.submitList.push({systemId:"",content:[]})},addGzjh:function(){this.gzjh.push({systemId:"",gzjh:""})},delGzjh:function(t){this.gzjh.splice(t,1)},del:function(t){this.submitList.splice(t,1)},delList:function(t,e){this.submitList[t].content.splice(e,1)}},mounted:function(){var t=this;this.init(),this.documentId=this.$route.query.id,""!=this.documentId?Object(n["v"])(this.$route.query.type,{id:this.$route.query.id}).then((function(e){if(e.data.length>0){t.title=e.data[0].content[0].documentName,t.time=new Date(e.data[0].content[0].year+"-"+e.data[0].content[0].month),t.submitList=[];for(var s=0;s<e.data.length;s++)t.submitList.push({systemId:e.data[s]._id.systemId,systemName:e.data[s]._id.systemName,time:e.data[s]._id.time,content:e.data[s].content})}e.gzjh.length>0&&(t.gzjh=e.gzjh)})):"month"==this.$route.query.type&&(this.title="设计部".concat(r()().format("YYYY年MM月"),"工作总结（").concat(JSON.parse(localStorage.getItem("userInfo")).nickName,"）"))}},c=l,m=(s("83d3f"),s("cba8")),u=Object(m["a"])(c,a,i,!1,null,null,null);e["default"]=u.exports}}]);
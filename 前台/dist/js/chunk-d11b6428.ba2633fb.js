(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d11b6428"],{"77b8":function(t,e,s){"use strict";s.r(e);var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"home-main"},[1===t.type?[s("Row",{style:{marginBottom:"15px"},attrs:{gutter:10}},[s("Col",{attrs:{span:"6"}},[s("infor-card",{attrs:{"id-name":"user_created_count","end-val":t.weekCount,iconType:"md-shuffle",color:"#2d8cf0","intro-text":"上月累计工时"}})],1),s("Col",{attrs:{span:"6"}},[s("infor-card",{attrs:{"id-name":"visit_count","end-val":t.monthCount,iconType:"ios-eye",color:"#64d572","intro-text":"本月累计工时"}})],1),s("Col",{attrs:{span:"6"}},[s("infor-card",{attrs:{"id-name":"collection_count","end-val":t.yearCount,iconType:"ios-time",color:"#ffd572","intro-text":"本年累计工时"}})],1),s("Col",{attrs:{span:"6"}},[s("infor-card",{attrs:{"id-name":"transfer_count","end-val":t.systemCount,iconType:"md-desktop",color:"#f25e43","intro-text":"系统总数"}})],1)],1),s("Row",{style:{marginBottom:"15px"}},[s("Col",{attrs:{span:"24"}},[s("Card",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("查询条件")]),s("Row",{attrs:{gutter:20}},[s("Col",{attrs:{span:"16"}},[s("Date-picker",{staticClass:"margin-bottom20",staticStyle:{width:"100%"},attrs:{value:t.showdate,type:"daterange",confirm:"",placeholder:"选择日期"},on:{"on-change":t.handelChange}})],1),s("Col",{attrs:{span:"8"}},[s("Button",{staticClass:"margin-bottom20",attrs:{type:"primary",ghost:""},on:{click:function(e){return t.quickTime("week")}}},[t._v("本周")]),s("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.quickTime("month")}}},[t._v("本月")]),s("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.quickTime("preMonth")}}},[t._v("上月")])],1)],1),s("Row",{attrs:{gutter:20}},[s("Col",{attrs:{span:"16"}},[s("Select",{staticClass:"margin-bottom20",attrs:{clearable:"",multiple:"",placeholder:"选择员工"},on:{"on-change":t.peopleChange},model:{value:t.people,callback:function(e){t.people=e},expression:"people"}},t._l(t.peopleList,(function(e){return s("Option",{key:e.userId,attrs:{value:e.userId}},[t._v(t._s(e.nickName?e.nickName:e.userName))])})),1)],1),s("Col",{attrs:{span:"8"}},[s("Button",{staticClass:"margin-bottom20",attrs:{type:"primary",ghost:""},on:{click:function(e){t.people=[]}}},[t._v("清空选择")]),s("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.peopleAll}},[t._v("选择全部")])],1)],1),s("Row",{attrs:{gutter:20}},[s("Col",{attrs:{span:"16"}},[s("Select",{staticClass:"margin-bottom20",attrs:{clearable:"",multiple:"",placeholder:"选择系统"},model:{value:t.system,callback:function(e){t.system=e},expression:"system"}},t._l(t.systemList,(function(e){return s("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.title))])})),1)],1),s("Col",{attrs:{span:"8"}},[s("Button",{staticClass:"margin-bottom20",attrs:{type:"primary",ghost:""},on:{click:t.clearallSystems}},[t._v("清空选择")]),s("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.editallSystems}},[t._v("选择全部")]),s("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.editSystems}},[t._v("快速选择")])],1)],1),s("Button",{attrs:{type:"primary"},on:{click:t.seach}},[t._v("查询")]),s("ButtonGroup",{staticStyle:{"margin-left":"10px"}},["admin"===t.isReset?s("Button",{attrs:{type:"info",ghost:""},on:{click:t.resetTime}},[t._v("重置工时")]):t._e(),"admin"===t.isReset?s("Button",{attrs:{type:"success",ghost:""},on:{click:function(e){return t.exportTime(!1)}}},[t._v("生成备份")]):t._e(),"admin"===t.isReset?s("Button",{attrs:{type:"warning",ghost:""},on:{click:t.inportTime}},[t._v("上传备份")]):t._e(),"admin"===t.isReset?s("Button",{attrs:{type:"error",ghost:""},on:{click:t.installTime}},[t._v("恢复备份")]):t._e(),"admin"===t.isReset?s("Button",{attrs:{type:"error",ghost:""},on:{click:t.checkTimeFn}},[t._v("查漏")]):t._e()],1)],1)],1)],1),s("Row",[s("Col",{attrs:{span:"24"}},[s("Card",[s("p",{attrs:{slot:"title"},slot:"title"},[t._v("查询结果")]),s("Button",{attrs:{slot:"extra",type:"primary"},on:{click:function(e){return t.exportData()}},slot:"extra"},[t._v("导出数据")]),s("div",{staticClass:"demo-tabs-style2"},[s("Tabs",{attrs:{type:"card"}},[s("Tab-pane",{attrs:{label:"表格"}},[t.columns.length>0?s("Table",{ref:"table",attrs:{border:"",columns:t.columns,data:t.workList,stripe:""},scopedSlots:t._u([{key:"systemName",fn:function(e){var a=e.row;return[s("strong",[t._v(t._s(a.systemName))])]}}],null,!1,820694384)}):t._e()],1),s("Tab-pane",{attrs:{label:"图表"}},[s("Row",{style:{marginBottom:"20px"}},[s("Col",{attrs:{span:"24"}},[s("Card",[s("p",{staticClass:"card-title",attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"md-map"}}),t._v("系统工时统计（共计"+t._s(t.total)+"小时）\n                      ")],1),s("div",{staticClass:"data-source-row"},[s("div",{staticStyle:{width:"100%",height:"300px"},attrs:{id:"visite_volume_con"}})])])],1)],1),s("Row",{style:{marginBottom:"10px"}},[s("Col",{attrs:{span:"24"}},[s("Card",[s("p",{staticClass:"card-title",attrs:{slot:"title"},slot:"title"},[s("Icon",{attrs:{type:"md-map"}}),t._v("系统工时占比分析（共计"+t._s(t.total)+"小时）\n                      ")],1),s("div",{staticClass:"data-source-row",staticStyle:{width:"100%",height:"500px"}},[s("div",{staticStyle:{width:"100%",height:"100%"},attrs:{id:"data_source_con"}})])])],1)],1)],1)],1)],1),s("Modal",{staticClass:"systemModal",attrs:{title:"请选择系统","mask-closable":!1,width:500,styles:{top:"30px"}},model:{value:t.systemModalVisible,callback:function(e){t.systemModalVisible=e},expression:"systemModalVisible"}},[s("Tree",{ref:"sysTree",attrs:{"empty-text":"请联系管理员录入系统列表",data:t.systemData,"show-checkbox":"","check-directly":"",multiple:""}}),t.treeLoading?s("Spin",{attrs:{size:"large"}}):t._e(),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"text"},on:{click:t.cancelsystemEdit}},[t._v("取消")]),s("Button",{attrs:{type:"primary"},on:{click:t.submitsystemEdit}},[t._v("确定")])],1)],1)],1)],1)],1)]:[s("personal")],s("Modal",{attrs:{title:"上传文件（工时备份）"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("Upload",{attrs:{multiple:"",type:"drag",action:t.action}},[s("div",{staticStyle:{padding:"40px 0"}},[s("Icon",{staticStyle:{color:"#3399ff"},attrs:{type:"ios-cloud-upload",size:"52"}}),s("p",[t._v("Click or drag files here to upload")])],1)]),s("div",{attrs:{slot:"footer"},slot:"footer"},[s("Button",{attrs:{type:"primary"},on:{click:function(e){t.show=!1}}},[t._v("关闭")])],1)],1)],2)},i=[],o=s("365c"),n=s("caaf"),r=s.n(n),l=s("663f"),c=s("4d28"),d=s.n(c),m=s("1663c"),u=s("efac");function p(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var h={name:"home",data:function(){var t;return t={show:!1,action:"",isReset:JSON.parse(localStorage.getItem("userInfo")).userName,type:"",systemCount:0,weekCount:0,monthCount:0,yearCount:0,total:0,startTime:"",endTime:"",people:[],showdate:[],peopleList:[],system:[],systemList:[],workList:[],systemData:[],systemModalVisible:!1,treeLoading:!1},p(t,"systemData",[]),p(t,"editSystem",[]),p(t,"selectAllFlag",!1),p(t,"visiteVolume",null),p(t,"dataSourcePie",null),p(t,"option",{tooltip:{trigger:"axis",axisPointer:{type:"shadow"}},color:["#87cefa","#ff7f50","#da70d6","#32cd32","#6495ed","#ff69b4","#ba55d3","#cd5c5c","#ffa500","#40e0d0","#1e90ff","#ff6347","#7b68ee","#00fa9a","#ffd700","#6699FF","#ff6666","#3cb371","#b8860b","#30e0e0"],grid:{top:"10%",left:"2%",right:"4%",bottom:"10%",containLabel:!0},xAxis:{type:"category",data:[],axisLabel:{interval:0,rotate:30},nameTextStyle:{color:"#c3c3c3"}},yAxis:{type:"value"},series:[{name:"工作小时数",type:"bar",data:[]}]}),p(t,"option1",{tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},color:["#ff7f50","#87cefa","#da70d6","#32cd32","#6495ed","#ff69b4","#ba55d3","#cd5c5c","#ffa500","#40e0d0","#1e90ff","#ff6347","#7b68ee","#00fa9a","#ffd700","#6699FF","#ff6666","#3cb371","#b8860b","#30e0e0"],series:[{name:"工时占比",type:"pie",radius:"50%",center:["50%","60%"],data:[],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}),t},components:{inforCard:m["a"],personal:u["default"]},computed:{columns:function(){if(""!==this.startTime&&""!==this.endTime){var t=[],e=Object(l["a"])(this.startTime,this.endTime);t.push({title:"系统/时间(h)",minWidth:150,fixed:"left",key:"systemName",sortable:!0,slot:"systemName"});for(var s=0;s<e.length;s++)t.push({title:e[s],key:e[s],width:100,sortable:!0,align:"center"});return t}return[]}},methods:{checkTimeFn:function(){var t=this,e=[];this.people.forEach((function(s){e.push(_.find(t.peopleList,["userId",s]).userName)})),Object(o["j"])({userList:e,startTime:this.startTime,endTime:this.endTime}).then((function(s){for(var a=[],i=0;i<s.data.length;i++)if(s.data[i].details.length<10&&s.data[i].details.length>7)for(var o=0;o<e.length;o++)_.find(s.data[i].details,["userName",e[o]])||a.push("时间：".concat(r()(s.data[i]._id.timeDate).format("YYYY-MM-DD"),'；工时：<span style="color: #c30">未录</span>；员工：').concat(_.find(t.peopleList,["userName",e[o]]).nickName));else for(var n=0;n<s.data[i].details.length;n++)s.data[i].details[n].timeCount<7&&a.push("时间：".concat(r()(s.data[i]._id.timeDate).format("YYYY-MM-DD"),"；工时：").concat(s.data[i].details[n].timeCount,"；员工：").concat(_.find(t.peopleList,["userName",s.data[i].details[n].userName]).nickName));t.$Modal.info({title:"遗漏工时",content:a.join("<br>")}),console.log(JSON.stringify(a))}))},installTime:function(){var t=this;this.$Modal.confirm({title:"提示",content:"数据恢复将会导致原有数据清空，确定执行此操作？",onOk:function(){Object(o["W"])().then((function(e){1===e.code&&t.$Message.success("导入成功")}))}})},inportTime:function(){this.show=!0},exportTime:function(t){var e=this;Object(o["G"])({sendMail:t}).then((function(s){1===s.code&&(t?e.$Message.success("文件已经通过邮件形式发送"):window.location.href="http://172.16.2.131:3333/download/all")}))},resetTime:function(){var t=this;Object(o["ob"])().then((function(e){1===e.code?t.$Message.success("重置成功"):t.$Message.error("重置失败")}))},peopleChange:function(t){var e=this;if(0!==t.length){var s={userlist:t};Object(o["K"])(s).then((function(t){1===t.code&&(e.system=t.data)}))}else this.system=[]},init:function(){var t=this,e=JSON.parse(localStorage.getItem("userInfo"));Object(o["Bb"])({userId:e.userId}).then((function(e){1===e.code&&(t.systemCount=e.data.systemCount,t.weekCount=e.data.weekCount,t.monthCount=e.data.monthCount,t.yearCount=e.data.yearCount)}))},quickTime:function(t){"week"==t?(this.startTime=Object(l["i"])(),this.endTime=Object(l["h"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):"month"==t?(this.startTime=Object(l["e"])(),this.endTime=Object(l["d"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):(this.startTime=Object(l["c"])(),this.endTime=Object(l["b"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime))},clearallSystems:function(){this.system=[]},peopleAll:function(){this.people=[];for(var t=0;t<this.peopleList.length;t++){var e=this.peopleList[t];this.people.push(e.userId)}},editallSystems:function(){this.system=[];for(var t=0;t<this.systemList.length;t++){var e=this.systemList[t];this.system.push(e.id)}},editSystems:function(){var t=this;this.treeLoading=!0,Object(o["M"])().then((function(e){if(t.treeLoading=!1,1===e.code){for(var s=0;s<e.data.length;s++)for(var a=0;a<e.data[s].children.length;a++)t.system.includes(e.data[s].children[a].id)?t.$set(e.data[s].children[a],"checked",!0):t.$set(e.data[s].children[a],"checked",!1);t.systemData=e.data,t.systemModalVisible=!0}}))},cancelsystemEdit:function(){this.systemModalVisible=!1},submitsystemEdit:function(){var t=[],e=this.$refs.sysTree.getCheckedNodes();e.forEach((function(e){t.push(e.id)})),this.system=t,this.systemModalVisible=!1},exportData:function(){this.$refs.table.exportCsv({filename:"工时统计"})},handelChange:function(t){this.startTime=t[0],this.endTime=t[1]},seach:function(){var t={startTime:this.startTime,endTime:this.endTime,people:this.people,system:this.system};""!=this.startTime&&""!=this.endTime&&0!=this.people.length&&0!=this.system.length?this.getTimeList(t):this.$Message.info("查询条件必填")},getTimeList:function(t){var e=this;Object(o["I"])(t).then((function(t){1===t.code&&(e.workList=t.data)})),Object(o["J"])(t).then((function(t){if(1===t.code){e.$Message.success("查询成功"),e.option.xAxis.data=[],e.option.series[0].data=[],e.option1.series[0].data=[],e.total=0;for(var s=0;s<t.data.length;s++)e.option.xAxis.data.push(t.data[s]._id.systemName);for(var a=0;a<t.data.length;a++)e.option.series[0].data.push({name:t.data[a]._id.systemName,value:t.data[a].time}),e.option1.series[0].data.push({name:t.data[a]._id.systemName,value:t.data[a].time}),e.total+=t.data[a].time;e.dataSourcePie.setOption(e.option1),e.visiteVolume.setOption(e.option)}}))},getUserList:function(){var t=this;Object(o["H"])().then((function(e){1===e.code&&(t.peopleList=e.data)}))},getSystemList:function(){var t=this;Object(o["L"])().then((function(e){1===e.code&&(t.systemList=e.data)}))}},mounted:function(){var t=this;this.action="http://"+window.location.hostname+":3333"+o["yb"],this.type=JSON.parse(localStorage.getItem("userInfo")).type,1===this.type&&(this.init(),this.getUserList(),this.getSystemList(),this.$nextTick((function(){t.visiteVolume=d.a.init(document.getElementById("visite_volume_con")),t.dataSourcePie=d.a.init(document.getElementById("data_source_con"))})))}},f=h,y=(s("e897"),s("cba8")),g=Object(y["a"])(f,a,i,!1,null,null,null);e["default"]=g.exports},a93e:function(t,e,s){},e897:function(t,e,s){"use strict";s("a93e")}}]);
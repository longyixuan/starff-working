(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-34ee5334"],{"0446":function(t,e,s){},3570:function(t,e,s){"use strict";s("0446")},"3e4b":function(t,e,s){"use strict";s.r(e);var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("Card",{staticClass:"marginB-20",attrs:{title:"工作总结标题/时间"}},[s("template",{slot:"extra"},[s("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:function(e){return t.$router.go(-1)}}},[t._v("返回")])],1),s("Input",{staticClass:"summary-input marginB-20",attrs:{placeholder:"样例：xxxx年xx月月终工作总结（员工姓名）"},model:{value:t.title,callback:function(e){t.title=e},expression:"title"}}),s("DatePicker",{attrs:{format:"yyyy年MM月dd日",type:"date",placeholder:"工作总结时间"},on:{"on-change":t.onChange},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],2),s("Card",{staticClass:"marginB-20",attrs:{title:"工作总结"}},[t._l(t.submitList,(function(e,i){return s("div",{staticClass:"summary-template"},[s("Tag",{staticClass:"summary-tag",attrs:{color:"primary",size:"large"}},[t._v(t._s(i+1))]),s("Tag",{staticClass:"summary-tag-right",attrs:{color:"warning",size:"large"},nativeOn:{click:function(e){return t.del(i)}}},[s("Icon",{attrs:{type:"md-close"}})],1),s("Row",{staticClass:"marginB-20",attrs:{gutter:20}},[s("Col",{attrs:{span:"20"}},[s("Select",{attrs:{placeholder:"选择系统",filterable:""},model:{value:e.systemId,callback:function(s){t.$set(e,"systemId",s)},expression:"summary.systemId"}},[t._l(t.sysList,(function(e){return[s("Option",{directives:[{name:"show",rawName:"v-show",value:t.systems.includes(e.id),expression:"systems.includes(item.id)"}],attrs:{value:e.id}},[t._v(t._s(e.title))])]}))],2)],1),s("Col",{attrs:{span:"4"}},[s("Input",{attrs:{placeholder:"工时"},model:{value:e.time,callback:function(s){t.$set(e,"time",s)},expression:"summary.time"}})],1)],1),s("Row",{attrs:{gutter:16}},t._l(e.content,(function(a,n){return s("Col",{staticClass:"marginB-20",attrs:{span:"24"}},[s("Card",[s("div",{staticClass:"marginB-20"},[s("Select",{staticStyle:{width:"400px"},attrs:{filterable:"",placeholder:"填写模块名称"},model:{value:a.contentTitle,callback:function(e){t.$set(a,"contentTitle",e)},expression:"modalItem.contentTitle"}},t._l(t.sysFilter(e.systemId),(function(e,i){return s("Option",{key:i,attrs:{value:e.modelId}},[t._v(t._s(e.modelName))])})),1),t._v("\n                            下拉选项中没有的模块，请在系统模块管理中添加。\n                        ")],1),s("Input",{staticClass:"marginB-20",attrs:{type:"textarea",rows:4,placeholder:"填写工作内容"},model:{value:a.contentDescription,callback:function(e){t.$set(a,"contentDescription",e)},expression:"modalItem.contentDescription"}}),s("Button",{attrs:{type:"error"},on:{click:function(e){return t.delList(i,n)}}},[t._v("删除当前记录")])],1)],1)})),1),s("Row",[s("Button",{attrs:{type:"primary",ghost:""},on:{click:function(e){return t.addModal(i)}}},[t._v("添加记录")])],1)],1)})),s("div",{staticClass:"summary-template-add marginB-20",on:{click:t.addSummary}},[s("Icon",{attrs:{type:"md-add",size:"120",color:"#999"}})],1)],2),s("Card",{staticClass:"marginB-20",attrs:{title:"工作计划"}},[t._l(t.gzjh,(function(e,i){return s("div",{staticClass:"summary-template"},[s("Tag",{staticClass:"summary-tag",attrs:{color:"primary",size:"large"}},[t._v(t._s(i+1))]),s("Tag",{staticClass:"summary-tag-right",attrs:{color:"warning",size:"large"},nativeOn:{click:function(e){return t.delGzjh(i)}}},[s("Icon",{attrs:{type:"md-close"}})],1),s("Row",{attrs:{gutter:20}},[s("Col",{staticClass:"marginB-20",attrs:{span:"24"}},[s("Select",{attrs:{placeholder:"选择系统",filterable:""},model:{value:e.systemId,callback:function(s){t.$set(e,"systemId",s)},expression:"summary.systemId"}},[t._l(t.sysList,(function(e){return[s("Option",{directives:[{name:"show",rawName:"v-show",value:t.systems.includes(e.id),expression:"systems.includes(item.id)"}],attrs:{value:e.id}},[t._v(t._s(e.title))])]}))],2)],1),s("Col",{attrs:{span:"24"}},[s("Input",{staticClass:"marginB-20",attrs:{type:"textarea",rows:6,placeholder:"填写工作内容"},model:{value:e.gzjh,callback:function(s){t.$set(e,"gzjh",s)},expression:"summary.gzjh"}})],1)],1)],1)})),s("div",{staticClass:"summary-template-add marginB-20",on:{click:t.addGzjh}},[s("Icon",{attrs:{type:"md-add",size:"120",color:"#999"}})],1)],2),s("Row",[s("Button",{attrs:{type:"primary",size:"large",long:""},on:{click:t.submit}},[t._v("保存")])],1),s("Modal",{attrs:{title:t.modalTitle},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[s("Input",{attrs:{placeholder:"输入模块名称"},model:{value:t.value,callback:function(e){t.value=e},expression:"value"}}),s("template",{slot:"footer"},[s("Button",{on:{click:function(e){t.modal=!1}}},[t._v("取消")]),s("Button",{attrs:{type:"primary"},on:{click:t.addModalName}},[t._v("添加模块")])],1)],2)],1)},a=[],n=s("365c"),o=s("caaf"),r=s.n(o),c={data:function(){return{todayTimeCount:0,gzjh:[],title:"",modalTitle:"",modelList:[],value:"",id:"",modal:!1,documentId:"",sysList:[],time:new Date,modalList:[],systems:JSON.parse(localStorage.getItem("userInfo")).systems,submitList:[]}},methods:{add:function(t){this.submitList[t].systemId?(this.id=this.submitList[t].systemId,this.modalTitle=_.find(this.sysList,["id",this.id]).title,this.modal=!0):this.$Message.error("请先选择系统")},getTodayTime:function(){var t=this;Object(n["wb"])({userId:JSON.parse(localStorage.getItem("userInfo")).userId,date:r()(this.time).format("YYYY-MM-DD")}).then((function(e){t.todayTimeCount=e.data}))},sysFilter:function(t){return _.filter(this.modelList,["systemId",t])},addModalName:function(){var t=this;if(""!=this.value){var e=_.find(this.sysList,["id",this.id]).modal;e.push(this.value);var s={systemId:this.id,modalList:Array.from(new Set(e))};Object(n["c"])(s).then((function(e){1===e.code&&(t.$Message.success("添加成功"),t.modal=!1,t.init(),t.value)}))}else this.$Message.error("请填写模块名称")},onChange:function(t){this.title="设计部".concat(t,"工作小结（").concat(JSON.parse(localStorage.getItem("userInfo")).nickName,"）")},setPostData:function(){var t=this,e=[],s=JSON.parse(localStorage.getItem("userInfo"));return this.submitList.forEach((function(i,a){i.content.forEach((function(n){e.push({documentId:t.documentId,documentName:t.title,userId:s.userId,userName:s.userName,nickName:s.nickName,year:r()(t.time).format("YYYY"),month:r()(t.time).format("MM"),day:r()(t.time).format("DD"),systemId:i.systemId,order:a,time:i.time,systemName:_.find(t.sysList,["id",i.systemId]).title,contentTitle:n.contentTitle,contentDescription:n.contentDescription})}))})),e},checkForm:function(t){var e=!0,s=0;return t.forEach((function(t){t.time?s+=t.time:e=!1})),s<7&&(e=!1),e},checkNum:function(t){var e=0;return t.forEach((function(t){t.time&&(e+=t.time)})),e},submitGo:function(t){var e=this;""!=this.documentId?Object(n["z"])(this.$route.query.type,t).then((function(t){1==t.code?e.$router.go(-1):e.$Message.error(t.msg)})):Object(n["b"])(this.$route.query.type,t).then((function(t){1==t.code?e.$router.go(-1):e.$Message.error(t.msg)}))},setGzjh:function(){var t=this,e=[];return this.gzjh.forEach((function(s,i){e.push({systemId:s.systemId,systemName:_.find(t.sysList,["id",s.systemId]).title,gzjh:s.gzjh})})),e},submit:function(){var t=this;if(0!=this.gzjh.length){var e={summaryName:this.title,list:this.setPostData(),gzjh:this.setGzjh()};0!=this.checkNum(e.list)||0!=this.todayTimeCount?this.checkForm(e.list)?this.submitGo(e):this.$Modal.confirm({title:"提示",content:"该天存在工时遗漏填写或填写时间不足情况，是否继续提交？提交后可在工时模块中补齐",onOk:function(){t.submitGo(e)}}):this.$Message.error("请添加工时")}else this.$Message.error("请填写工作计划")},init:function(){var t=this;Object(n["Y"])().then((function(e){t.modelList=e.data,Object(n["L"])().then((function(e){t.sysList=e.data}))}))},addModal:function(t){this.submitList[t].content.push({contentTitle:"",contentDescription:""})},addSummary:function(){this.submitList.push({systemId:"",content:[]})},addGzjh:function(){this.gzjh.push({systemId:"",gzjh:""})},del:function(t){this.submitList.splice(t,1)},delGzjh:function(t){this.gzjh.splice(t,1)},delList:function(t,e){this.submitList[t].content.splice(e,1)}},mounted:function(){var t=this;this.init(),this.getTodayTime(),this.documentId=this.$route.query.id,""!=this.documentId?Object(n["v"])(this.$route.query.type,{id:this.$route.query.id}).then((function(e){if(e.data.length>0){t.title=e.data[0].content[0].documentName,t.time=new Date(e.data[0].content[0].year+"-"+e.data[0].content[0].month+"-"+e.data[0].content[0].day),t.submitList=[];for(var s=0;s<e.data.length;s++)t.submitList.push({systemId:e.data[s]._id.systemId,systemName:e.data[s]._id.systemName,time:e.data[s]._id.time,content:e.data[s].content})}t.gzjh=e.gzjh})):"day"==this.$route.query.type&&(this.title="设计部".concat(r()().format("YYYY年MM月DD日"),"工作小结（").concat(JSON.parse(localStorage.getItem("userInfo")).nickName,"）"))}},l=c,m=(s("3570"),s("cba8")),u=Object(m["a"])(l,i,a,!1,null,null,null);e["default"]=u.exports}}]);
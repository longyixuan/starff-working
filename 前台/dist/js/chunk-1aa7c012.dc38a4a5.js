(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1aa7c012"],{"117f":function(t,e,i){"use strict";i("8953")},"663f":function(t,e,i){"use strict";i.d(e,"a",(function(){return n})),i.d(e,"g",(function(){return d})),i.d(e,"f",(function(){return p})),i.d(e,"i",(function(){return f})),i.d(e,"h",(function(){return g})),i.d(e,"e",(function(){return y})),i.d(e,"d",(function(){return w})),i.d(e,"c",(function(){return v})),i.d(e,"b",(function(){return _})),Date.prototype.format=function(){var t="",e=this.getMonth()+1>=10?this.getMonth()+1:"0"+(this.getMonth()+1),i=this.getDate()>=10?this.getDate():"0"+this.getDate();return t+=this.getFullYear()+"-",t+=e+"-",t+=i,t};var n=function(t,e){var i=[],n=t.split("-"),s=e.split("-"),a=new Date;a.setUTCFullYear(n[0],n[1]-1,n[2]);var r=new Date;r.setUTCFullYear(s[0],s[1]-1,s[2]);for(var o=a.getTime()-864e5,c=r.getTime()-864e5,l=o;l<=c;)l+=864e5,i.push(new Date(parseInt(l)).format());return i},s=new Date,a=s.getDay(),r=s.getDate(),o=s.getMonth(),c=s.getYear();c+=c<2e3?1900:0;var l=new Date;l.setDate(1),l.setMonth(l.getMonth()-1);l.getYear();var u=l.getMonth();function m(t){var e=t.getFullYear(),i=t.getMonth()+1,n=t.getDate();return i<10&&(i="0"+i),n<10&&(n="0"+n),e+"-"+i+"-"+n}function h(t){var e=new Date(c,t,1),i=new Date(c,t+1,1),n=(i-e)/864e5;return n}function d(){var t=new Date(c,o,r-a+1-7);return m(t)}function p(){var t=new Date(c,o,r+(6-a)+1-7);return m(t)}function f(){var t=new Date(c,o,r-a+1);return m(t)}function g(){var t=new Date(c,o,r+(6-a)+1);return m(t)}function y(){var t=new Date(c,o,1);return m(t)}function w(){var t=new Date(c,o,h(o));return m(t)}function v(){var t=new Date(c,u,1);return m(t)}function _(){var t=new Date(c,u,h(u));return m(t)}},8953:function(t,e,i){},c45c:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("Card",{attrs:{title:"周总结"}},[i("Tabs",{attrs:{value:"my",animated:!1}},[i("TabPane",{attrs:{label:"我的总结",name:"my"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("DatePicker",{attrs:{format:"yyyy年",type:"year",placeholder:"工作总结时间"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}}),i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.initList}},[t._v("查询")]),i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.addTemplate}},[t._v("新增")])],1),i("Table",{staticStyle:{"margin-bottom":"20px"},attrs:{border:"",columns:t.columns,data:t.list},on:{"on-selection-change":t.selectionChange},scopedSlots:t._u([{key:"name",fn:function(e){var n=e.row;return[i("strong",[t._v(t._s(n._id.documentName))]),n._id.status_info.length>0?["0"==n._id.status_info[0].status?i("Tag",{attrs:{color:"red"}},[t._v("已退回")]):t._e(),"1"==n._id.status_info[0].status?i("Tag",{attrs:{color:"green"}},[t._v("已修正")]):t._e()]:t._e()]}},{key:"time",fn:function(e){var n=e.row;return[i("strong",[t._v(t._s(t._f("timeFilter")(n._id.startDay))+" - "+t._s(t._f("timeFilter")(n._id.endDay)))])]}},{key:"action",fn:function(e){var n=e.row,s=e.index;return[i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.show(n._id.documentId)}}},[t._v("查看")]),i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",disabled:n.details[0].status,size:"small"},on:{click:function(e){return t.edit(n._id.documentId)}}},[t._v("修改")]),i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"error",disabled:n.details[0].status,size:"small"},on:{click:function(e){return t.del(s,n._id.documentId)}}},[t._v("删除")]),i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",disabled:n.details[0].status,size:"small"},on:{click:function(e){return t.commit(s,n._id.documentId,!0)}}},[t._v("上报")])]}}])}),i("Button",{attrs:{type:"primary"},on:{click:t.merge}},[t._v("合并查看")]),i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"warning"},on:{click:function(e){t.modal=!0}}},[t._v("合并生成月总结")])],1),i("TabPane",{attrs:{label:"部门总结",name:"part"}},[i("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:20}},[i("Col",{attrs:{span:"16"}},[i("Date-picker",{staticClass:"margin-bottom20",staticStyle:{width:"100%"},attrs:{value:t.showdate,type:"daterange",confirm:"",placeholder:"选择日期"},on:{"on-change":t.handelChange}})],1),i("Col",{attrs:{span:"8"}},[i("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.quickTime("week")}}},[t._v("本周")]),i("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:function(e){return t.quickTime("preweek")}}},[t._v("上周")])],1)],1),i("Row",{staticStyle:{"margin-bottom":"10px"},attrs:{gutter:20}},[i("Col",{attrs:{span:"16"}},[i("Select",{staticClass:"margin-bottom20",attrs:{clearable:"",multiple:"",placeholder:"选择员工"},model:{value:t.people,callback:function(e){t.people=e},expression:"people"}},t._l(t.peopleList,(function(e){return i("Option",{key:e.userId,attrs:{value:e.userId}},[t._v(t._s(e.nickName?e.nickName:e.userName))])})),1)],1),i("Col",{attrs:{span:"8"}},[i("Button",{staticClass:"margin-bottom20",attrs:{type:"primary",ghost:""},on:{click:function(e){t.people=[]}}},[t._v("清空选择")]),i("Button",{staticClass:"margin-bottom20",staticStyle:{"margin-left":"10px"},attrs:{type:"primary",ghost:""},on:{click:t.peopleAll}},[t._v("选择全部")])],1)],1),i("Button",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"primary"},on:{click:t.seach}},[t._v("查询")]),i("Table",{staticStyle:{"margin-bottom":"20px"},attrs:{border:"",columns:t.columnPart,data:t.listPart},on:{"on-selection-change":t.selectionChangePart},scopedSlots:t._u([{key:"name",fn:function(e){var n=e.row;return[i("strong",[t._v(t._s(n._id.documentName))]),n._id.status_info.length>0?["0"==n._id.status_info[0].status?i("Tag",{attrs:{color:"red"}},[t._v("已退回")]):t._e(),"1"==n._id.status_info[0].status?i("Tag",{attrs:{color:"green"}},[t._v("已修正")]):t._e()]:t._e()]}},{key:"people",fn:function(e){var n=e.row;return[i("strong",[t._v(t._s(n.details[0].nickName))])]}},{key:"action",fn:function(e){var n=e.row,s=e.index;return[i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.adminshow(n._id.documentId)}}},[t._v("查看")]),1===t.type?i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"warning",disabled:!n.details[0].status,size:"small"},on:{click:function(e){return t.commit(s,n._id.documentId,!1)}}},[t._v("退回")]):t._e()]}}])}),i("Button",{attrs:{type:"primary"},on:{click:t.mergePart}},[t._v("合并查看")])],1)],1),i("Modal",{attrs:{title:"合并生成月总结"},model:{value:t.modal,callback:function(e){t.modal=e},expression:"modal"}},[i("Input",{staticStyle:{"margin-bottom":"20px"},attrs:{type:"text",placeholder:"请输出月总结名称"},model:{value:t.monthTitle,callback:function(e){t.monthTitle=e},expression:"monthTitle"}}),i("DatePicker",{attrs:{format:"yyyy年MM月",type:"month",placeholder:"选择年月"},on:{"on-change":t.onChange},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}}),i("template",{slot:"footer"},[i("Button",{on:{click:function(e){t.modal=!1}}},[t._v("取消")]),i("Button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary"},on:{click:t.mergeMonth}},[t._v("确定")])],1)],2)],1)},s=[],a=i("365c"),r=i("663f"),o=i("caaf"),c=i.n(o),l={data:function(){return{monthTitle:"设计部2020年05月工作总结（姓名）",modal:!1,list:[],listPart:[],showdate:[],type:0,startTime:"",endTime:"",selectionList:[],selectionListPart:[],time:new Date,peopleList:[],people:[],columns:[{type:"index",width:60,align:"center"},{type:"selection",width:60,align:"center"},{title:"名称",slot:"name"},{title:"日期",width:260,align:"center",slot:"time"},{title:"操作",slot:"action",width:260,align:"center"}],columnPart:[{type:"index",width:60,align:"center"},{type:"selection",width:60,align:"center"},{title:"名称",slot:"name"},{title:"人员",width:100,align:"center",slot:"people"},{title:"操作",slot:"action",width:160,align:"center"}]}},filters:{timeFilter:function(t){return c()(t).format("YYYY年MM月DD日")}},methods:{onChange:function(t){this.monthTitle="设计部".concat(t,"工作总结（").concat(JSON.parse(localStorage.getItem("userInfo")).nickName,"）")},handelChange:function(t){this.startTime=t[0],this.endTime=t[1]},selectionChange:function(t){this.selectionList=t},selectionChangePart:function(t){this.selectionListPart=t},peopleAll:function(){this.people=[];for(var t=0;t<this.peopleList.length;t++){var e=this.peopleList[t];this.people.push(e.userId)}},commit:function(t,e,i){var n=this,s=i?"上报之后不可修改和删除，是否要上报？":"确定要退回吗？";this.confirm(s,(function(){Object(a["n"])({documentId:e,status:i}).then((function(e){1==e.code&&(i?(n.$set(n.list[t].details[0],"status",i),n.$Message.success("上报成功")):(n.$set(n.listPart[t].details[0],"status",i),n.$Message.success("退回成功")))}))}))},quickTime:function(t){"yestday"==t?(this.startTime=c()().add(-1,"days").format("YYYY-MM-DD"),this.endTime=c()().add(-1,"days").format("YYYY-MM-DD"),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):"day"==t?(this.startTime=c()().format("YYYY-MM-DD"),this.endTime=c()().format("YYYY-MM-DD"),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):"week"==t?(this.startTime=Object(r["i"])(),this.endTime=Object(r["h"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):"preweek"==t?(this.startTime=Object(r["g"])(),this.endTime=Object(r["f"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):"month"==t?(this.startTime=Object(r["e"])(),this.endTime=Object(r["d"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime)):(this.startTime=Object(r["c"])(),this.endTime=Object(r["b"])(),this.showdate=[],this.showdate.push(this.startTime),this.showdate.push(this.endTime))},getUserList:function(){var t=this;Object(a["H"])().then((function(e){1===e.code&&(t.peopleList=e.data,t.peopleAll())}))},merge:function(){var t=[],e=[];if(0!=this.selectionList.length){for(var i=0;i<this.selectionList.length;i++)t.push(this.selectionList[i]._id.documentId),e.push(this.selectionList[i].details[0].day);this.$router.push({name:"summary-merge",query:{mergeList:t,type:"week"}})}else this.$Message.error("请选择要合并的总结")},mergePart:function(){var t=[];if(0!=this.selectionListPart.length)if(this.selectionListPart.length<2)this.$Message.error("请至少选择2行内容进行合并查看");else{for(var e=0;e<this.selectionListPart.length;e++)t.push(this.selectionListPart[e]._id.documentId);var i=this.$router.resolve({name:"summary-merge",query:{mergeList:t,type:"week",admin:!0}});window.open(i.href,"_blank")}else this.$Message.error("请选择要合并的总结")},download:function(t){window.location.href="http://"+window.location.hostname+":3333/download/markdown?fileName="+t},initList:function(){var t=this;Object(a["X"])("week",{userId:JSON.parse(localStorage.getItem("userInfo")).userId,year:c()(this.time).format("YYYY"),month:c()(this.time).format("MM")}).then((function(e){1==e.code&&(t.list=_.sortBy(e.data,"_id",(function(t){return new Date(t._id.startDay).getTime()})).reverse(),t.$Message.success("查询成功"))}))},seach:function(){var t=this,e={startTime:this.startTime,endTime:this.endTime,people:this.people,system:this.system};0!=this.people.length?Object(a["rb"])(e).then((function(e){t.listPart=e.data.filter((function(t){return t._id.status_info.length>0||t.details[0].status})),t.$Message.success("查询成功")})):this.$Message.info("查询条件必填")},adminshow:function(t){var e=this.$router.resolve({name:"summary-admindetails",query:{id:t,type:"week"}});window.open(e.href,"_blank")},show:function(t){var e=this.$router.resolve({name:"summary-details",query:{id:t,type:"week"}});window.open(e.href,"_blank")},edit:function(t){this.$router.push({name:"summary-editweek",query:{id:t,type:"week"}})},del:function(t,e){var i=this;this.confirm("确定要删除？",(function(){Object(a["u"])("week",{documentId:e}).then((function(e){1==e.code&&(i.list.splice(t,1),i.$Message.success("删除成功"))}))}))},confirm:function(t,e){this.$Modal.confirm({title:"提示",content:t,onOk:function(){e()}})},mergeMonth:function(){for(var t=this,e=[],i=0;i<this.selectionList.length;i++)e.push(this.selectionList[i]._id.documentId);var n={documentName:this.monthTitle,userId:JSON.parse(localStorage.getItem("userInfo")).userId,userName:JSON.parse(localStorage.getItem("userInfo")).userName,nickName:JSON.parse(localStorage.getItem("userInfo")).nickName,year:c()(this.time).format("YYYY"),month:c()(this.time).format("MM"),list:e};Object(a["ub"])(n).then((function(e){1===e.code&&(t.$Message.success("生成成功，请至月总结中查看"),t.modal=!1)}))},addTemplate:function(){this.$router.push({name:"summary-editweek",query:{id:"",type:"week"}})},checkTime:function(){var t=this;Object(a["k"])({startTime:Object(r["i"])(),endTime:Object(r["h"])(),userId:JSON.parse(localStorage.getItem("userInfo")).userId}).then((function(e){e.data.length>0&&e.data[0].timeCount<35&&t.$Notice.warning({duration:0,title:"提醒",desc:"系统检测本周工时有遗漏，请核查后补充"})}))}},mounted:function(){this.initList(),this.getUserList(),this.type=JSON.parse(localStorage.getItem("userInfo")).type,this.peopleAll(),this.monthTitle="设计部".concat(c()().format("YYYY年MM月"),"工作总结（").concat(JSON.parse(localStorage.getItem("userInfo")).nickName,"）"),0===this.type&&(this.columnPart[this.columnPart.length-1].width=100)}},u=l,m=(i("117f"),i("cba8")),h=Object(m["a"])(u,n,s,!1,null,"e62a050e",null);e["default"]=h.exports}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-39d421fc"],{"5fb7":function(t,e,i){"use strict";i("bc6a")},bc6a:function(t,e,i){},e866:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("Card",{attrs:{title:"系统时间线"}},[i("div",{staticStyle:{"margin-bottom":"20px"}},[i("DatePicker",{staticStyle:{width:"120px","margin-right":"10px"},attrs:{type:"year",placeholder:"请选择年份"},model:{value:t.year,callback:function(e){t.year=e},expression:"year"}}),i("Select",{staticStyle:{width:"400px","margin-right":"10px"},attrs:{clearable:"",filterable:"",multiple:"",placeholder:"请选择系统"},model:{value:t.system,callback:function(e){t.system=e},expression:"system"}},t._l(t.sysList,(function(e){return i("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.title))])})),1),i("Select",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{clearable:"",placeholder:"请选择标签"},model:{value:t.tag,callback:function(e){t.tag=e},expression:"tag"}},t._l(t.tags,(function(e){return i("Option",{key:e.id,attrs:{value:e.id}},[t._v(t._s(e.name))])})),1),i("Input",{staticStyle:{width:"200px","margin-right":"10px"},attrs:{clearable:"",placeholder:"请输入关键字",autocomplete:"off"},model:{value:t.keyword,callback:function(e){t.keyword=e},expression:"keyword"}}),i("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.seach}},[t._v("查询")]),i("div",{staticStyle:{float:"right"}},[i("Button",{staticStyle:{"margin-right":"10px"},attrs:{type:"primary"},on:{click:t.exportExcel}},[t._v("导出Excel")]),i("Button",{attrs:{type:"primary",to:"/time-line/add"}},[t._v("新增时间线")])],1)],1),i("Tabs",{attrs:{type:"card"},model:{value:t.tabName,callback:function(e){t.tabName=e},expression:"tabName"}},[i("TabPane",{attrs:{label:"表格显示",name:"name1"}},[i("Table",{ref:"table",attrs:{border:"",columns:t.columns,data:t.data},scopedSlots:t._u([{key:"model",fn:function(e){var a=e.row;return[t.modelList.length>0?t._l(a.model,(function(e){return i("Tag",{key:e},[t._v(t._s(t._f("modelFilter")(e,t.modelList)))])})):t._e()]}},{key:"tag",fn:function(e){var a=e.row;return[i("Tag",{attrs:{type:"border",color:"warning"}},[t._v(t._s(t._f("tagFilter")(a.tag,t.tags)))])]}},{key:"action",fn:function(e){var a=e.row,n=e.index;return[i("Button",{staticStyle:{"margin-right":"5px"},attrs:{type:"primary",size:"small"},on:{click:function(e){return t.updateTimeline(a.timelineId,n)}}},[t._v("编辑")]),i("Button",{attrs:{type:"error",size:"small"},on:{click:function(e){return t.deleteTimeline(a.timelineId,n)}}},[t._v("删除")])]}}])})],1),i("TabPane",{attrs:{label:"时间线显示",name:"name2"}},["name2"==t.tabName?i("ul",{staticClass:"timeline"},t._l(t.lineDate,(function(e){return i("li",{staticClass:"timeline-item"},[i("div",{staticClass:"timeline-time"},[i("span",[t._v(t._s(e._id.time))])]),i("div",{staticClass:"timeline-icon"}),i("div",{staticClass:"timeline-label"},t._l(e.details,(function(e){return i("div",{staticStyle:{"margin-bottom":"20px"}},[i("h2",[t._v(t._s(e.systemName)),i("Tag",{staticStyle:{"margin-left":"10px"},attrs:{color:"warning"}},[t._v(t._s(t._f("tagFilter")(e.tag,t.tags)))])],1),i("div",{staticStyle:{"margin-bottom":"10px"}},t._l(e.model,(function(e){return i("Tag",{key:e,staticStyle:{"font-weight":"bold"},attrs:{type:"dot",color:"primary"}},[t._v(t._s(t._f("modelFilter")(e,t.modelList)))])})),1),i("div",{staticStyle:{"white-space":"pre-line","word-break":"break-all","font-size":"14px","line-height":"1.5"},domProps:{innerHTML:t._s(e.description)}})])})),0)])})),0):t._e()])],1)],1)],1)},n=[],l=i("365c"),r=i("caaf"),s=i.n(r),o={name:"timeline",data:function(){return{modal:!0,year:new Date,system:[],sysList:[],tag:"",keyword:"",model:[],tabName:"name1",modelList:[],tags:[],data:[],lineDate:[],exportData:[],columns:[{title:"时间",key:"time",width:120,align:"center"},{title:"系统",key:"systemName",width:200},{title:"模块",key:"model",slot:"model",width:300},{title:"备注",key:"description",render:function(t,e){return t("div",{class:"pre-div"},e.row.description)}},{title:"标签",slot:"tag",width:120},{title:"最后更新人",key:"userName",width:120},{title:"操作",slot:"action",width:140,align:"center"}]}},created:function(){var t=this;Object(l["N"])().then((function(e){t.tags=e.data}))},filters:{tagFilter:function(t,e){return _.find(e,["id",t]).name},modelFilter:function(t,e){return _.find(e,["modelId",t])?_.find(e,["modelId",t]).modelName:""}},methods:{updateTimeline:function(t,e){this.$router.push({name:"time-line-edit",query:{id:t}})},deleteTimeline:function(t,e){var i=this;this.$Modal.confirm({title:"提示",content:"确定要删除吗？",onOk:function(){Object(l["p"])({id:t}).then((function(t){i.data.splice(e,1),i.$Message.success("删除成功")}))}})},seach:function(){this.getlist()},getlist:function(){var t=this,e={year:s()(this.year).format("YYYY"),tag:this.tag,system:this.system,keyword:this.keyword};Object(l["R"])(e).then((function(e){1===e.code&&(t.data=_.sortBy(e.data,(function(t){return new Date(t.time).getTime()})).reverse(),t.lineDate=_.sortBy(e.timeSys,(function(t){return new Date(t._id.time).getTime()})).reverse())}))},init:function(){var t=this;Object(l["L"])().then((function(e){t.sysList=e.data}))},modelStr:function(t){for(var e=[],i=0;i<t.length;i++)e.push(_.find(this.modelList,["modelId",t[i]]).modelName);return e.join("、")},exportExcel:function(){for(var t=0;t<this.data.length;t++)this.exportData.push({description:this.data[t].description.replaceAll("\n",""),model:this.modelStr(this.data[t].model),systemName:this.data[t].systemName,tag:_.find(this.tags,["id",this.data[t].tag]).name,time:this.data[t].time,timelineId:this.data[t].timelineId});this.$refs.table.exportCsv({filename:"系统时间线",columns:[{title:"时间",key:"time",width:120,align:"center"},{title:"系统",key:"systemName",width:200},{title:"模块",key:"model",width:300},{title:"备注",key:"description"},{title:"标签",key:"tag",width:120}],data:this.exportData})}},mounted:function(){var t=this;this.getlist(),this.init(),Object(l["Y"])().then((function(e){t.modelList=e.data}))}},c=o,d=(i("5fb7"),i("cba8")),m=Object(d["a"])(c,a,n,!1,null,null,null);e["default"]=m.exports}}]);